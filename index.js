(function(h,F,g){"use strict";let u,p,f;const s=g.findByProps("sendMessage","editMessage"),w=g.findByProps("promptToUpload");g.findByProps("clearAll","upload");const b=1;async function M(){if(!u)try{const t=await import("https://esm.sh/gifenc@1.0.3");u=t.GIFEncoder,p=t.quantize,f=t.applyPalette}catch(t){throw console.error("[ImgToGif] Failed to load gifenc library:",t),new Error("Failed to load GIF encoding library")}}function U(t){const n=t instanceof File,e=n?URL.createObjectURL(t):t;return new Promise(function(a,c){const i=new Image;i.onload=function(){n&&URL.revokeObjectURL(e),a(i)},i.onerror=function(d,o,r,y,l){return c(l||d)},i.crossOrigin="Anonymous",i.src=e})}async function G(t,n,e){await M();const a=await U(t);let c,i;n&&e?(c=n,i=e):n?(c=n,i=Math.round(a.height/a.width*n)):e?(i=e,c=Math.round(a.width/a.height*e)):(c=a.width,i=a.height);const d=u(),o=document.createElement("canvas");o.width=c,o.height=i;const r=o.getContext("2d");for(let l=0;l<b;l++){r.clearRect(0,0,o.width,o.height),r.drawImage(a,0,0,a.width,a.height,0,0,o.width,o.height);const{data:v}=r.getImageData(0,0,o.width,o.height),I=p(v,256),C=f(v,I);d.writeFrame(C,o.width,o.height,{transparent:!0,palette:I})}d.finish();const y=t.name?t.name.replace(/\.[^/.]+$/,""):"converted";return new File([new Uint8Array(d.bytesView())],`${y}.gif`,{type:"image/gif"})}let m;var T={onLoad:function(){m=F.registerCommand({name:"imgtogif",displayName:"Image to GIF",description:"Convert an image to a GIF",options:[{name:"image",displayName:"image",description:"Image attachment to convert",required:!0,type:11},{name:"width",displayName:"width",description:"Width of the output GIF (optional)",required:!1,type:4},{name:"height",displayName:"height",description:"Height of the output GIF (optional)",required:!1,type:4}],execute:async function(t,n){try{let e=null,a,c;for(const r of t)r.name==="image"?e=r.value:r.name==="width"?a=Number(r.value):r.name==="height"&&(c=Number(r.value));if(!e){s.sendMessage(n.channel.id,{content:"\u274C No image specified! Please attach an image."},void 0,{nonce:Date.now().toString()});return}s.sendMessage(n.channel.id,{content:"\u{1F504} Converting image to GIF..."},void 0,{nonce:Date.now().toString()});const i=await(await fetch(e.url)).blob(),d=new File([i],e.filename||"image.png",{type:i.type});if(!d.type.startsWith("image/")){s.sendMessage(n.channel.id,{content:"\u274C The attachment is not a valid image!"},void 0,{nonce:Date.now().toString()});return}const o=await G(d,a,c);w?.promptToUpload?setTimeout(function(){w.promptToUpload([o],n.channel,0)},10):s.sendMessage(n.channel.id,{content:"\u2705 GIF created! (Upload handler not available, cannot auto-upload)"},void 0,{nonce:Date.now().toString()})}catch(e){console.error("[ImgToGif] Error:",e),s.sendMessage(n.channel.id,{content:`\u274C Error: ${String(e)}`},void 0,{nonce:Date.now().toString()})}},applicationId:"-1",inputType:1,type:1})},onUnload:function(){m&&m()}};return h.default=T,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.commands,vendetta.metro);
