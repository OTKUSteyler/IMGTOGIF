(function(d,w,u){"use strict";const g=u.findByProps("sendMessage","editMessage"),h=u.findByProps("promptToUpload");function y(a){const t=a instanceof File,e=t?URL.createObjectURL(a):a;return new Promise(function(n,c){const o=new Image;o.onload=function(){t&&URL.revokeObjectURL(e),n(o)},o.onerror=function(i,s,r,p,m){return c(m||i)},o.crossOrigin="Anonymous",o.src=e})}async function v(a,t,e){const n=await y(a);let c,o;t&&e?(c=t,o=e):t?(c=t,o=Math.round(n.height/n.width*t)):e?(o=e,c=Math.round(n.width/n.height*e)):(c=n.width,o=n.height);const i=document.createElement("canvas");i.width=c,i.height=o;const s=i.getContext("2d");if(!s)throw new Error("Could not get canvas context");s.clearRect(0,0,i.width,i.height),s.drawImage(n,0,0,n.width,n.height,0,0,i.width,i.height);const r=await new Promise(function(m,I){i.toBlob(function(f){f?m(f):I(new Error("Failed to create blob"))},"image/png")}),p=a.name?a.name.replace(/\.[^/.]+$/,""):"converted";return new File([r],`${p}.png`,{type:"image/png"})}let l;var b={onLoad:function(){l=w.registerCommand({name:"imgtogif",displayName:"Image to GIF",description:"Convert/resize an image (outputs as PNG due to mobile limitations)",options:[{name:"image",displayName:"image",description:"Image attachment to convert",required:!0,type:11},{name:"width",displayName:"width",description:"Width of the output image (optional)",required:!1,type:4},{name:"height",displayName:"height",description:"Height of the output image (optional)",required:!1,type:4}],execute:async function(a,t){try{console.log("[ImgToGif] Args received:",JSON.stringify(a,null,2)),console.log("[ImgToGif] Context:",JSON.stringify(t,null,2));let e=null,n,c;for(const r of a)console.log("[ImgToGif] Processing arg:",r.name,r),r.name==="image"?(e=r.value,console.log("[ImgToGif] Found image attachment:",e)):r.name==="width"?n=Number(r.value):r.name==="height"&&(c=Number(r.value));if(!e){g.sendMessage(t.channel.id,{content:"\u274C No image specified! Please attach an image. Debug: "+JSON.stringify(a)},void 0,{nonce:Date.now().toString()});return}g.sendMessage(t.channel.id,{content:"\u{1F504} Processing image..."},void 0,{nonce:Date.now().toString()});const o=await(await fetch(e.url)).blob(),i=new File([o],e.filename||"image.png",{type:o.type});if(!i.type.startsWith("image/")){g.sendMessage(t.channel.id,{content:"\u274C The attachment is not a valid image!"},void 0,{nonce:Date.now().toString()});return}const s=await v(i,n,c);h?.promptToUpload?setTimeout(function(){h.promptToUpload([s],t.channel,0)},10):g.sendMessage(t.channel.id,{content:"\u2705 Image processed! (Upload handler not available)"},void 0,{nonce:Date.now().toString()})}catch(e){console.error("[ImgToGif] Error:",e),g.sendMessage(t.channel.id,{content:`\u274C Error: ${String(e)}`},void 0,{nonce:Date.now().toString()})}},applicationId:"-1",inputType:1,type:1})},onUnload:function(){l&&l()}};return d.default=b,Object.defineProperty(d,"__esModule",{value:!0}),d})({},vendetta.commands,vendetta.metro);
