(function(g,w,l){"use strict";const s=l.findByProps("sendMessage","editMessage"),h=l.findByProps("promptToUpload");function y(r){const n=r instanceof File,e=n?URL.createObjectURL(r):r;return new Promise(function(t,a){const o=new Image;o.onload=function(){n&&URL.revokeObjectURL(e),t(o)},o.onerror=function(i,d,c,p,u){return a(u||i)},o.crossOrigin="Anonymous",o.src=e})}async function v(r,n,e){const t=await y(r);let a,o;n&&e?(a=n,o=e):n?(a=n,o=Math.round(t.height/t.width*n)):e?(o=e,a=Math.round(t.width/t.height*e)):(a=t.width,o=t.height);const i=document.createElement("canvas");i.width=a,i.height=o;const d=i.getContext("2d");if(!d)throw new Error("Could not get canvas context");d.clearRect(0,0,i.width,i.height),d.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height);const c=await new Promise(function(u,M){i.toBlob(function(f){f?u(f):M(new Error("Failed to create blob"))},"image/png")}),p=r.name?r.name.replace(/\.[^/.]+$/,""):"converted";return new File([c],`${p}.png`,{type:"image/png"})}let m;var b={onLoad:function(){m=w.registerCommand({name:"imgtogif",displayName:"Image to GIF",description:"Convert/resize an image (outputs as PNG due to mobile limitations)",options:[{name:"image",displayName:"image",description:"Image attachment to convert",required:!0,type:11},{name:"width",displayName:"width",description:"Width of the output image (optional)",required:!1,type:4},{name:"height",displayName:"height",description:"Height of the output image (optional)",required:!1,type:4}],execute:async function(r,n){try{let e=null,t,a;for(const c of r)c.name==="image"?e=c.value:c.name==="width"?t=Number(c.value):c.name==="height"&&(a=Number(c.value));if(!e){s.sendMessage(n.channel.id,{content:"\u274C No image specified! Please attach an image."},void 0,{nonce:Date.now().toString()});return}s.sendMessage(n.channel.id,{content:"\u{1F504} Processing image..."},void 0,{nonce:Date.now().toString()});const o=await(await fetch(e.url)).blob(),i=new File([o],e.filename||"image.png",{type:o.type});if(!i.type.startsWith("image/")){s.sendMessage(n.channel.id,{content:"\u274C The attachment is not a valid image!"},void 0,{nonce:Date.now().toString()});return}const d=await v(i,t,a);h?.promptToUpload?setTimeout(function(){h.promptToUpload([d],n.channel,0)},10):s.sendMessage(n.channel.id,{content:"\u2705 Image processed! (Upload handler not available)"},void 0,{nonce:Date.now().toString()})}catch(e){console.error("[ImgToGif] Error:",e),s.sendMessage(n.channel.id,{content:`\u274C Error: ${String(e)}`},void 0,{nonce:Date.now().toString()})}},applicationId:"-1",inputType:1,type:1})},onUnload:function(){m&&m()}};return g.default=b,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.commands,vendetta.metro);
