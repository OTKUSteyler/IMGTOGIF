(function(g,w,u){"use strict";const m=u.findByProps("sendMessage","editMessage"),p=u.findByProps("promptToUpload");function y(c){const t=c instanceof File,n=t?URL.createObjectURL(c):c;return new Promise(function(o,i){const e=new Image;e.onload=function(){t&&URL.revokeObjectURL(n),o(e)},e.onerror=function(a,r,d,s,h){return i(h||a)},e.crossOrigin="Anonymous",e.src=n})}async function v(c,t,n){const o=await y(c);let i,e;t&&n?(i=t,e=n):t?(i=t,e=Math.round(o.height/o.width*t)):n?(e=n,i=Math.round(o.width/o.height*n)):(i=o.width,e=o.height);const a=document.createElement("canvas");a.width=i,a.height=e;const r=a.getContext("2d");if(!r)throw new Error("Could not get canvas context");r.clearRect(0,0,a.width,a.height),r.drawImage(o,0,0,o.width,o.height,0,0,a.width,a.height);const d=await new Promise(function(h,I){a.toBlob(function(f){f?h(f):I(new Error("Failed to create blob"))},"image/png")}),s=c.name?c.name.replace(/\.[^/.]+$/,""):"converted";return new File([d],`${s}.png`,{type:"image/png"})}let l;var b={onLoad:function(){l=w.registerCommand({name:"imgtogif",displayName:"Image to GIF",description:"Convert/resize an image (outputs as PNG due to mobile limitations)",options:[{name:"image",displayName:"image",description:"Image attachment to convert",required:!0,type:11},{name:"width",displayName:"width",description:"Width of the output image (optional)",required:!1,type:4},{name:"height",displayName:"height",description:"Height of the output image (optional)",required:!1,type:4}],execute:async function(c,t){try{let n=null,o,i;for(const s of c)s.name==="image"?n=s.value:s.name==="width"?o=Number(s.value):s.name==="height"&&(i=Number(s.value));console.log("[ImgToGif] Attachment ID:",n),console.log("[ImgToGif] Context attachments:",t.attachments);let e=null;if(t.attachments&&t.attachments.length>0&&(e=t.attachments[n]||t.attachments[0]),!e&&t.attachments&&typeof n=="number"&&(e=Object.values(t.attachments)[n]),!e&&t.message?.attachments&&(e=t.message.attachments[0]),console.log("[ImgToGif] Found attachment:",e),!e||!e.url){m.sendMessage(t.channel.id,{content:`\u274C No image found! Attachment ID: ${n}, Context: ${JSON.stringify(Object.keys(t))}`},void 0,{nonce:Date.now().toString()});return}m.sendMessage(t.channel.id,{content:"\u{1F504} Processing image..."},void 0,{nonce:Date.now().toString()});const a=await(await fetch(e.url)).blob(),r=new File([a],e.filename||"image.png",{type:a.type});if(!r.type.startsWith("image/")){m.sendMessage(t.channel.id,{content:"\u274C The attachment is not a valid image!"},void 0,{nonce:Date.now().toString()});return}const d=await v(r,o,i);p?.promptToUpload?setTimeout(function(){p.promptToUpload([d],t.channel,0)},10):m.sendMessage(t.channel.id,{content:"\u2705 Image processed! (Upload handler not available)"},void 0,{nonce:Date.now().toString()})}catch(n){console.error("[ImgToGif] Error:",n),m.sendMessage(t.channel.id,{content:`\u274C Error: ${String(n)}`},void 0,{nonce:Date.now().toString()})}},applicationId:"-1",inputType:1,type:1})},onUnload:function(){l&&l()}};return g.default=b,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.commands,vendetta.metro);
